<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EP2C Upload</title>
  <link rel="stylesheet" href="/static/css/styles.css">
  <style>
    :root{
      --bg:#070b11;
      --card:#0f141a;
      --muted:#a8b3c7;
      --brand:#2a74ff;
      --brand-2:#7aa3ff;
      --stroke:#1e2630;
      --stroke-2:#263041;
      --text:#e7eef8;
      --ok:#66d9a3;
    }

    html,body{height:100%;}
    body{
      margin:0; color:var(--text); background: var(--bg);
      background-image:
        radial-gradient(60rem 30rem at 10% -10%, rgba(42,116,255,.15), transparent),
        radial-gradient(70rem 35rem at 110% 20%, rgba(122,163,255,.12), transparent),
        radial-gradient(50rem 40rem at 50% 120%, rgba(102,217,163,.08), transparent);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
      overflow:hidden;  
    }


    .wrap{
      max-width:1000px; padding:48px 20px; margin:0 auto;
      height:100vh; display:flex; flex-direction:column; justify-content:flex-start;
    }
    .hero{
      display:flex; flex-direction:column; align-items:center; text-align:center; gap:10px; margin-bottom:24px; user-select:none;
    }
    .logo{
      width:180px; height:60px; border-radius:16px;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      display:grid; place-items:center; font-weight:800; letter-spacing:.5px; color:#06122a;
      box-shadow: 0 10px 30px rgba(42,116,255,.35);
    }
    .logo span{ font-size:1.15rem; }
    .title{font-size:2.2rem; margin:0;}
    .subtitle{margin:0; color:var(--muted); max-width:720px}


    .card{
      margin:22px auto 0;
      max-width: 1040px;             
      background: color-mix(in srgb, var(--card) 85%, transparent);
      border:1px solid var(--stroke);
      border-radius:20px;
      padding:-0px 20px;             
      box-shadow: 0 12px 40px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
      backdrop-filter: blur(6px);
      overflow: visible;            
    }

    form .row{display:grid; grid-template-columns: 1fr; gap:18px; margin-top:18px;}
    @media (min-width:780px){ form .row{grid-template-columns: 2fr 1fr;} }

    .field label{display:block; margin:0 0 8px; font-weight:700;}
    .muted{color:var(--muted);}

    .drop{
      display:grid; place-items:center; text-align:center;
      background:#0b0f14; border:1px dashed var(--stroke-2); border-radius:12px; min-height:140px;
      padding:16px; transition:border-color .2s, background .2s, transform .08s ease;
      cursor:pointer;
    }
    .drop:hover{border-color:var(--brand); background:#0b111a;}
    .drop:active{transform:scale(.997)}
    .drop .big{font-weight:700;}
    .drop small{display:block; margin-top:8px; color:var(--muted)}
    .types{display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px}
    .pill{
      border:1px solid var(--stroke-2); border-radius:999px; padding:4px 8px; font-size:.85rem; color:var(--muted);
    }

    .hidden-input{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0 0 0 0); border:0;}
    select{
      width:100%; background:#0b0f14; border:1px solid var(--stroke-2); color:var(--text);
      border-radius:12px; padding:12px; appearance:none;
    }

    .actions{margin-top:22px; display:flex; gap:12px; justify-content:center}
    .primary{
      background:linear-gradient(180deg, var(--brand), #1e5fe0); border:1px solid #1c55c8;
      color:white; padding:12px 18px; border-radius:12px; cursor:pointer; font-weight:800;
      box-shadow: 0 8px 22px rgba(42,116,255,.35);
      transition: transform .06s ease, box-shadow .15s ease, filter .15s ease;
    }
    .primary:hover{filter:brightness(1.05); box-shadow: 0 10px 30px rgba(42,116,255,.45);}
    .primary:active{transform: translateY(1px)}
    .ghost{display:none;}

    .benefits{display:grid; grid-template-columns: 1fr; gap:12px; margin:20px 0 0}
    @media (min-width:700px){ .benefits{grid-template-columns: repeat(3,1fr);} }
    .benefit{
      border:1px solid var(--stroke); border-radius:12px; padding:12px;
      background:rgba(255,255,255,.02); text-align:left;
    }
    .benefit b{display:block; margin-bottom:4px}
    ul.flash{margin-top:16px; padding-left:18px; color:#ffbebe;}

    .file-name{margin-top:8px; color:var(--ok); font-weight:700; font-size:.95rem; text-align:center}

    .tm{
      position:fixed; left:14px; bottom:12px; color:var(--muted); font-size:.85rem;
      opacity:.9; user-select:none;
    }

    .modal-overlay{
      position:fixed; inset:0; display:grid; place-items:center;
      background: rgba(7,11,17,.45);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      transition: opacity .18s ease;
      z-index: 1000;
    }
    .modal-overlay[aria-hidden="true"]{ opacity:0; pointer-events:none; }

    .loader{
      width:min(92vw, 520px);
      background: color-mix(in srgb, var(--card) 88%, transparent);
      border:1px solid var(--stroke);
      border-radius:16px;
      padding:20px 20px 18px;
      box-shadow: 0 16px 50px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03);
      text-align:center;
    }
    .loader h3{ margin:4px 0 10px; font-size:1.1rem; font-weight:800; letter-spacing:.3px; }
    .loader p{ margin:0 0 14px; color:var(--muted); font-size:.95rem; }

    .progress{
      height:14px; border-radius:999px; overflow:hidden;
      background:#0b0f14; border:1px solid var(--stroke-2);
    }
    .progress-fill{
      height:100%; width:24%;
      background: #28d17c;
      background-image:
        repeating-linear-gradient(45deg, rgba(255,255,255,.22) 0 12px, transparent 12px 24px);
      box-shadow: inset 0 -1px 0 rgba(0,0,0,.2);
      animation:
        loadPulse 1.8s ease-in-out infinite alternate,
        barberPole .7s linear infinite;
    }
    @keyframes loadPulse { from{width:12%} to{width:88%} }
    @keyframes barberPole { from{ background-position:0 0 } to{ background-position:48px 0 } }

    body.is-loading .wrap{ filter: blur(2px) saturate(.9); }

    .primary[disabled]{ opacity:.7; cursor:not-allowed; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="logo"><span>Paper → Code</span></div>
      <h1 class="title">EP2C</h1>
      <p class="subtitle">Turn research papers into reproducible, linked code. Upload your paper and pick a target language!</p>
    </div>

    <div class="card">
      <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
        <div class="row">
          <div class="field">
            <label for="paper">Paper</label>
            <label class="drop" for="paper" id="dropLabel">
              <div>
                <div class="big">Drag & drop your file here</div>
                <small>or click to choose</small>
                <div class="types">
                  <span class="pill">.pdf</span>
                  <span class="pill">.latex</span>
                  <span class="pill">.md</span>
                  <span class="pill">.json</span>
                </div>
              </div>
            </label>
            <input id="paper" class="hidden-input" name="paper" type="file" accept=".pdf,.latex,.md,.json" required>
            <div id="fileName" class="file-name" hidden></div>
          </div>

          <div class="field">
            <label for="language">Language</label>
            <select id="language" name="language" required>
              <option value="">— Select —</option>
              {% for lang in languages %}
              <option value="{{ lang }}">{{ lang }}</option>
              {% endfor %}
            </select>

            <div class="benefits">
              <div class="benefit">
                <b>Reproducible</b>
                <span class="muted">Sync symbols to paper chunks for traceable results and one-click jumps.</span>
              </div>
              <div class="benefit">
                <b>Explainable</b>
                <span class="muted">Human-readable explanations, non-coders can follow the logic.</span>
              </div>
              <div class="benefit">
                <b>Multilingual</b>
                <span class="muted">Choose the language that fits your stack.</span>
              </div>
            </div>
          </div>
        </div>

        <div class="actions">
          <button type="submit" class="primary">Continue</button>
        </div>
      </form>

      {% with messages = get_flashed_messages() %}
        {% if messages %}
          <ul class="flash">
            {% for message in messages %}<li>{{ message }}</li>{% endfor %}
          </ul>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <div class="tm">© 2025 CMSC473 EP2C Team™</div>

  <div id="loadingOverlay" class="modal-overlay" aria-hidden="true">
    <div class="loader">
      <h3>Preparing your viewer…</h3>
      <p>Uploading file, and running through the EP2C pipeline.</p>
      <div class="progress"><div class="progress-fill"></div></div>
    </div>
  </div>

  <script>
    (function(){
      const input = document.getElementById('paper');
      const label = document.getElementById('dropLabel');
      const fileName = document.getElementById('fileName');

      label.addEventListener('dragover', e => { e.preventDefault(); label.style.borderColor = getComputedStyle(document.documentElement).getPropertyValue('--brand'); });
      label.addEventListener('dragleave', () => { label.style.borderColor = 'var(--stroke-2)'; });
      label.addEventListener('drop', e => {
        e.preventDefault();
        if (e.dataTransfer.files && e.dataTransfer.files[0]) {
          input.files = e.dataTransfer.files;
          input.dispatchEvent(new Event('change', {bubbles:true}));
        }
        label.style.borderColor = 'var(--stroke-2)';
      });

      input.addEventListener('change', () => {
        const f = input.files && input.files[0];
        if (f) {
          fileName.textContent = f.name;
          fileName.hidden = false;
        } else {
          fileName.hidden = true;
        }
      });

      const form = document.getElementById('uploadForm');
      const overlay = document.getElementById('loadingOverlay');
      const submitBtn = form.querySelector('.primary');

      form.addEventListener('submit', () => {
        overlay.setAttribute('aria-hidden', 'false');
        document.body.classList.add('is-loading');
        submitBtn.disabled = true;
      });
    })();
  </script>
</body>
</html>
